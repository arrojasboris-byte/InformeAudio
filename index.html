<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Control Center Audio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- XLSX para Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root {
      --bg-main: radial-gradient(circle at top left, #111827, #020617 55%);
      --bg-main-light: #f3f4f6;
      --bg-card: #020617;
      --bg-card-light: #ffffff;
      --bg-card-soft: #0b1120;
      --text-main: #f9fafb;
      --text-main-light: #111827;
      --text-muted: #9ca3af;
      --text-muted-light: #6b7280;
      --border-soft: #1f2937;
      --border-soft-light: #e5e7eb;
      --accent-red: #ff2440;
      --accent-blue: #38bdf8;
      --accent-green: #22c55e;
      --accent-orange: #f97316;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

    html, body {
      width: 100%;
      height: 100%;
    }

    body {
      display: flex;
      background: var(--bg-main);
      color: var(--text-main);
      overflow: hidden;
    }

    body.light {
      background: var(--bg-main-light);
      color: var(--text-main-light);
    }

    /* SIDEBAR */
    .sidebar {
      width: 250px;
      background: #020617;
      border-right: 1px solid #020617;
      padding: 18px 18px 24px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      color: #e5e7eb;
    }

    body.light .sidebar {
      background: #111827;
      border-right-color: #020617;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-badge {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fee2e2, var(--accent-red));
    }

    .logo-text {
      display: flex;
      flex-direction: column;
    }

    .logo-title {
      font-weight: 700;
      font-size: 1.05rem;
    }

    .logo-subtitle {
      font-size: .7rem;
      color: #9ca3af;
    }

    .section-title {
      font-size: .75rem;
      text-transform: uppercase;
      color: #6b7280;
      letter-spacing: .12em;
      margin-bottom: 8px;
    }

    .nav-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 999px;
      font-size: .88rem;
      color: #9ca3af;
      cursor: pointer;
      transition: all .18s ease;
    }

    .nav-item span.icon {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: #020617;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: .75rem;
    }

    .nav-item.active {
      background: linear-gradient(90deg, #ff2440, #fb7185);
      color: #111827;
      font-weight: 600;
    }

    .nav-item.active span.icon {
      background: rgba(15,23,42,.2);
    }

    .nav-item:hover:not(.active) {
      background: rgba(31,41,55,0.9);
      color: #e5e7eb;
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: .78rem;
      color: #9ca3af;
    }

    /* MAIN */
    .main {
      flex: 1;
      padding: 10px 18px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 100vh;
      overflow: hidden;
    }

    .topbar {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .search-wrapper {
      flex: 1;
      position: relative;
    }

    .search-input {
      width: 100%;
      background: #020617;
      border-radius: 999px;
      padding: 8px 12px 8px 32px;
      border: 1px solid var(--border-soft);
      color: var(--text-main);
      font-size: .86rem;
      outline: none;
    }

    body.light .search-input {
      background: #ffffff;
      border-color: var(--border-soft-light);
      color: var(--text-main-light);
    }

    .search-wrapper .search-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: .8rem;
      color: var(--text-muted);
    }

    .topbar-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid var(--border-soft);
      font-size: .8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #020617;
      color: #e5e7eb;
      white-space: nowrap;
      box-shadow: none;
    }

    .btn span.icon {
      font-size: .85rem;
    }

    .btn-cta {
      background: linear-gradient(90deg, #ff2440, #fb7185);
      color: #111827;
      font-weight: 600;
      border-color: transparent;
    }

    body.light .btn {
      background: #ffffff;
      color: #111827;
      border-color: var(--border-soft-light);
    }

    body.light .btn-cta {
      color: #111827;
    }

    /* P√ÅGINAS */
    .page {
      flex: 1;
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      background: var(--bg-card);
      padding: 10px;
      display: none;
      flex-direction: column;
      gap: 10px;
      min-height: 0;
      overflow: hidden;
    }

    body.light .page {
      background: var(--bg-card-light);
      border-color: var(--border-soft-light);
    }

    .page.active {
      display: flex;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }

    .page-header h2 {
      font-size: 1rem;
    }

    .page-header small {
      font-size: .75rem;
      color: var(--text-muted);
    }

    /* Tarjeta simple */
    .card {
      background: var(--bg-card);
      border-radius: 14px;
      padding: 10px;
      border: 1px solid var(--border-soft);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    body.light .card {
      background: var(--bg-card-light);
      border-color: var(--border-soft-light);
    }

    .card h3 {
      font-size: .9rem;
    }

    .badge-small {
      font-size: .7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: #111827;
      color: var(--text-muted);
      border: 1px solid var(--border-soft);
    }

    body.light .badge-small {
      background: #e5e7eb;
      color: #374151;
      border-color: #d1d5db;
    }

    /* DASHBOARD LAYOUT */
    #page-dashboard {
      gap: 10px;
    }

    .dash-filters {
      display: flex;
      gap: 10px;
    }

    .dash-filters .card {
      flex: 1;
    }

    .dash-filters select {
      margin-top: 4px;
      width: 100%;
      padding: 4px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--text-main);
      font-size: .78rem;
    }

    body.light .dash-filters select {
      background: #ffffff;
      border-color: var(--border-soft-light);
      color: var(--text-main-light);
    }

    .dash-kpi-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .dash-kpi {
      font-size: .8rem;
    }

    .dash-kpi strong {
      display: block;
      font-size: .85rem;
    }

    .dash-kpi span.value {
      font-size: 1rem;
      font-weight: 600;
    }

    .dash-main-grid {
      flex: 1;
      display: grid;
      grid-template-columns: 2fr 1.2fr;
      gap: 10px;
      min-height: 0;
    }

    .dash-charts {
      display: grid;
      grid-template-rows: repeat(2, 1fr);
      gap: 10px;
      min-height: 0;
    }

    .dash-charts-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      min-height: 0;
    }

    .chart-box {
      position: relative;
      min-height: 0;
    }

    .chart-box canvas {
      width: 100%;
      height: 100%;
    }

    .dash-ranking {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .ranking-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: .8rem;
    }

    .ranking-list {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
    }

    .ranking-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: .78rem;
      padding: 4px 0;
      gap: 6px;
    }

    .ranking-name {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ranking-bar {
      flex: 1.6;
      height: 6px;
      border-radius: 999px;
      background: #111827;
      overflow: hidden;
      margin: 0 6px;
    }

    .ranking-bar-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg,#22c55e,#38bdf8);
    }

    /* CENTROS */
    #page-centros {
      gap: 10px;
    }

    .centros-top {
      display: grid;
      grid-template-columns: 1.4fr 1.6fr 1.4fr;
      gap: 10px;
      min-height: 260px;
    }

    .delegados-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-height: 220px;
      overflow-y: auto;
    }

    .delegado-bar {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px;
      border-radius: 10px;
      cursor: pointer;
      background: #020617;
    }

    body.light .delegado-bar {
      background: #f3f4f6;
    }

    .delegado-bar-color {
      width: 8px;
      height: 8px;
      border-radius: 999px;
    }

    .delegado-bar-main {
      flex: 1;
      display: flex;
      justify-content: space-between;
      font-size: .78rem;
    }

    .delegados-actions {
      margin-top: 6px;
      display: flex;
      gap: 8px;
    }

    .calendar-grid {
      display: grid;
      grid-template-rows: auto auto 1fr;
      gap: 4px;
      height: 100%;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: .88rem;
      font-weight: 600;
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      font-size: .7rem;
      text-align: center;
      color: var(--text-muted);
    }

    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-auto-rows: 1fr;
      gap: 4px;
    }

    .calendar-day {
      border-radius: 10px;
      border: 1px solid #111827;
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      padding: 4px;
      font-size: .78rem;
      cursor: pointer;
      position: relative;
    }

    body.light .calendar-day {
      border-color: #e5e7eb;
    }

    .calendar-day.today {
      border-color: var(--accent-blue);
    }

    .calendar-day .day-number {
      font-weight: 600;
    }

    .calendar-day .day-badge {
      position: absolute;
      right: 4px;
      bottom: 4px;
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent-orange);
    }

    .visitas-list {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-height: 220px;
      overflow-y: auto;
      font-size: .78rem;
    }

    .visita-item {
      display: flex;
      flex-direction: column;
      gap: 2px;
      padding: 4px 6px;
      border-radius: 10px;
      background: #020617;
    }

    body.light .visita-item {
      background: #f3f4f6;
    }

    .visita-topline {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .tag-estado {
      border-radius: 999px;
      padding: 1px 6px;
      font-size: .7rem;
      border: 1px solid #1f2937;
    }

    .tag-pendiente { background: rgba(234,179,8,0.15); color: #eab308; border-color:#eab308;}
    .tag-realizada { background: rgba(22,163,74,0.15); color:#22c55e; border-color:#22c55e;}
    .tag-anulada   { background: rgba(248,113,113,0.15); color:#f97373; border-color:#f97373;}

    .centros-table-wrapper {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .centros-table-scroll {
      flex: 1;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: .78rem;
    }

    thead {
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 2;
    }

    body.light thead {
      background: #f9fafb;
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid #0b1120;
      text-align: left;
      white-space: nowrap;
    }

    body.light td {
      border-bottom-color: #e5e7eb;
    }

    th {
      font-weight: 600;
      font-size: .75rem;
      color: var(--text-muted);
    }

    tbody tr:nth-child(even) {
      background: #020617;
    }

    body.light tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    tbody tr:hover {
      background: rgba(15,23,42,0.9);
    }

    body.light tbody tr:hover {
      background: #e5e7eb;
    }

    .tag {
      border-radius: 999px;
      padding: 2px 6px;
      font-size: .7rem;
      border: 1px solid var(--border-soft);
      background: #0b1120;
    }

    .tag.exclusivo {
      background: rgba(22,163,74,0.15);
      color: var(--accent-green);
      border-color: rgba(22,163,74,0.7);
    }

    .tag.corner {
      background: rgba(37,99,235,0.15);
      color: var(--accent-blue);
      border-color: rgba(37,99,235,0.7);
    }

    .tag-aar {
      background: rgba(148,163,184,0.15);
      border-color: rgba(148,163,184,0.7);
      color: var(--text-muted);
    }

    .tag-aar.si {
      background: rgba(34,197,94,0.15);
      border-color: rgba(34,197,94,0.7);
      color: var(--accent-green);
    }

    .tag-aar.formacion {
      background: rgba(234,179,8,0.15);
      border-color: rgba(234,179,8,0.7);
      color: #eab308;
    }

    .btn-link {
      border: none;
      background: transparent;
      color: var(--accent-blue);
      cursor: pointer;
      font-size: .74rem;
      text-decoration: underline;
    }

    /* ====== INFORME DE LA VISITA ‚Äì NUEVO LAYOUT ====== */

    #page-informe {
      gap: 10px;
    }

    .informe-page {
      display: flex;
      flex-direction: column;
      gap: 10px;
      height: 100%;
      overflow-y: auto;
    }

    .informe-main-print {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .informe-card {
      background: var(--bg-card);
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    body.light .informe-card {
      background: var(--bg-card-light);
      border-color: var(--border-soft-light);
    }

    .informe-top-row {
      display: grid;
      grid-template-columns: 2.2fr 1.3fr;
      gap: 10px;
    }

    .informe-datos-grid {
      display: grid;
      grid-template-columns: 1.1fr 1.1fr;
      grid-template-rows: repeat(4, auto);
      gap: 6px 10px;
    }

    .informe-field {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.78rem;
    }

    .informe-field label {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .informe-field input {
      background: #020617;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      padding: 4px 8px;
      color: var(--text-main);
      font-size: 0.78rem;
    }

    body.light .informe-field input {
      background: #ffffff;
      border-color: var(--border-soft-light);
      color: var(--text-main-light);
    }

    .checklist-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .checklist-head small {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .checklist-file-info {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .informe-middle-row {
      display: grid;
      grid-template-columns: 1.5fr 1.1fr;
      gap: 10px;
    }

    .kpi-chart-box,
    .radar-chart-box {
      height: 210px;
    }

    .kpi-chart-box canvas,
    .radar-chart-box canvas {
      width: 100%;
      height: 100%;
    }

    .informe-third-row {
      display: grid;
      grid-template-columns: 1.4fr 1.6fr;
      gap: 10px;
    }

    .formaciones-box {
      max-height: 260px;
      overflow-y: auto;
    }

    .formaciones-box-inner {
      font-size: .78rem;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .imagenes-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .imagen-drop {
      border-radius: 12px;
      border: 1px dashed #334155;
      background: #020617;
      min-height: 130px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    body.light .imagen-drop {
      background: #f9fafb;
      border-color: #cbd5f5;
    }

    .imagen-drop input[type="file"] {
      margin-top: 6px;
      font-size: .7rem;
    }

    .informe-resumen-row {
      display: grid;
      grid-template-columns: 1.1fr 1fr 1fr;
      gap: 10px;
    }

    .resumen-chart-box {
      height: 220px;
    }

    .resumen-chart-box canvas {
      width: 100%;
      height: 100%;
    }

    .informe-text-row {
      display: grid;
      grid-template-columns: 1.1fr 1.1fr 1.1fr;
      gap: 10px;
    }

    .informe-text-area label {
      display: block;
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .informe-text-area textarea {
      width: 100%;
      min-height: 120px;
      resize: vertical;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      background: #020617;
      color: var(--text-main);
      font-size: 0.78rem;
      padding: 6px 8px;
    }

    body.light .informe-text-area textarea {
      background: #ffffff;
      border-color: var(--border-soft-light);
      color: var(--text-main-light);
    }

    .informe-footer {
      display: flex;
      justify-content: flex-end;
      margin-top: 6px;
    }

    #checklistImprimibleCard {
      display: none;
    }

    /* IMPRESI√ìN */
    @media print {
      body {
        background: #ffffff !important;
      }
      .sidebar,
      .topbar {
        display: none !important;
      }
      .main {
        padding: 0 !important;
      }
      .page {
        border: none !important;
        border-radius: 0 !important;
      }
      .page:not(.active) {
        display: none !important;
      }
      #page-informe {
        padding: 0 !important;
      }
      #page-informe .informe-page {
        overflow: visible !important;
      }
      #page-informe .informe-main-print {
        page-break-after: always;
      }
      #checklistImprimibleCard {
        display: block !important;
        page-break-inside: avoid;
      }
      #checklistImprimibleCard table {
        width: 100%;
        border-collapse: collapse;
        font-size: .7rem;
      }
      #checklistImprimibleCard th,
      #checklistImprimibleCard td {
        border: 1px solid #4b5563;
        padding: 3px 4px;
      }
    }
  </style>
</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">
      <div class="logo-badge"></div>
      <div class="logo-text">
        <span class="logo-title">Control Center Audio</span>
        <span class="logo-subtitle">Gesti√≥n de centros y delegados</span>
      </div>
    </div>

    <div>
      <div class="section-title">Secciones</div>
      <nav class="nav-list" id="navList">
        <div class="nav-item active" data-page="dashboard">
          <span class="icon">üìä</span> Dashboard
        </div>
        <div class="nav-item" data-page="centros">
          <span class="icon">üè¢</span> Centros
        </div>
        <div class="nav-item" data-page="informe">
          <span class="icon">üìù</span> Informe de la visita
        </div>
      </nav>
    </div>

    <div class="sidebar-footer">
      Versi√≥n demo ¬∑ Datos ficticios
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <!-- TOPBAR -->
    <div class="topbar">
      <div class="search-wrapper">
        <span class="search-icon">üîç</span>
        <input class="search-input" placeholder="Buscar por centro, propietario o delegado..." />
      </div>
      <div class="topbar-actions">
        <button class="btn" id="themeToggle"><span class="icon">üåì</span> Oscuro / Claro</button>
        <button class="btn"><span class="icon">üíæ</span> Guardar vista</button>
        <button class="btn btn-cta" id="btnExportHtml"><span class="icon">‚¨áÔ∏è</span> Exportar HTML</button>
        <button class="btn" id="btnPrint"><span class="icon">üñ®</span> Imprimir</button>
        <button class="btn btn-cta"><span class="icon">‚òÅÔ∏è</span> Actualizar datos nube</button>
      </div>
    </div>

    <!-- DASHBOARD -->
    <section id="page-dashboard" class="page active">
      <div class="page-header">
        <h2>Dashboard</h2>
      </div>

      <!-- Filtros -->
      <div class="dash-filters">
        <div class="card">
          <h3>Filtro por delegado</h3>
          <select id="filtroDelegadoDash">
            <option value="todos">Todos los delegados</option>
            <option>Daniel Chazo</option>
            <option>Eneritz ARANGUREN</option>
            <option>Blanca Fdez. de la Pradilla</option>
            <option>Marisa Carmona</option>
            <option>Sergio Per√°n</option>
            <option>Sonia Godino</option>
          </select>
        </div>
        <div class="card">
          <h3>Filtro por centro</h3>
          <select id="filtroCentroDash">
            <option value="todos">Todos los centros</option>
            <option>PAMPLONA C. Exclusivo</option>
            <option>REINA DE MERCEDES</option>
            <option>SANTIAGO DE COMPOSTELA RUA DA ROSA</option>
          </select>
        </div>
      </div>

      <!-- KPIs -->
      <div class="dash-kpi-row">
        <div class="card dash-kpi">
          <strong>% Procesos</strong>
          <span class="value" id="kpiProcesos">‚Äì</span>
          <span>Objetivo 85‚Äì100%</span>
        </div>
        <div class="card dash-kpi">
          <strong>Conversi√≥n a prueba</strong>
          <span class="value" id="kpiConvPrueba">‚Äì</span>
          <span>Objetivo 80%</span>
        </div>
        <div class="card dash-kpi">
          <strong>Conversi√≥n a venta</strong>
          <span class="value" id="kpiConvVenta">‚Äì</span>
          <span>Objetivo 80%</span>
        </div>
        <div class="card dash-kpi">
          <strong>% Primeros auxilios</strong>
          <span class="value" id="kpiPrimerosAux">‚Äì</span>
          <span>Equipos formados</span>
        </div>
      </div>

      <!-- Zona principal -->
      <div class="dash-main-grid">
        <div class="dash-charts">
          <div class="dash-charts-row">
            <div class="card chart-box">
              <h3>Radar general</h3>
              <canvas id="dashRadar"></canvas>
            </div>
            <div class="card chart-box">
              <h3>Procesos y √°reas de mejora por mes</h3>
              <canvas id="dashProcesosAreas"></canvas>
            </div>
            <div class="card chart-box">
              <h3>√Åreas de mejora por mes</h3>
              <canvas id="dashAreasMes"></canvas>
            </div>
          </div>
          <div class="dash-charts-row">
            <div class="card chart-box">
              <h3>Primeros auxilios por mes</h3>
              <canvas id="dashPrimerosAux"></canvas>
            </div>
            <div class="card chart-box">
              <h3>Top 10 √°reas de mejora</h3>
              <canvas id="dashTopAreas"></canvas>
            </div>
            <div class="card chart-box">
              <h3>Aplicaci√≥n AAR / HIT</h3>
              <canvas id="dashAARHIT"></canvas>
            </div>
          </div>
        </div>

        <!-- Ranking delegados -->
        <div class="card dash-ranking">
          <div class="ranking-header">
            <span>Ranking de delegados</span>
            <button class="btn-link" id="btnMostrarTodosDeleg">Mostrar todos</button>
          </div>
          <div class="ranking-list" id="rankingDelegados">
            <!-- se rellena con JS -->
          </div>
        </div>
      </div>
    </section>

    <!-- CENTROS -->
    <section id="page-centros" class="page">
      <div class="page-header">
        <h2>Centros</h2>
      </div>

      <div class="centros-top">
        <!-- Delegados -->
        <article class="card">
          <div class="page-header" style="margin-bottom:4px;">
            <h3 style="font-size:.9rem;">Centros y delegados</h3>
            <span class="badge-small" id="badgeNumDelegados">‚Äì delegados</span>
          </div>
          <div class="delegados-list" id="delegadosList"></div>
          <div class="delegados-actions">
            <button class="btn btn-cta" id="btnAddCentro">
              <span class="icon">‚ûï</span> A√±adir centro
            </button>
            <button class="btn" id="btnAdjuntarExcelCentros">
              <span class="icon">üì§</span> Adjuntar centros (Excel)
            </button>
            <input type="file" id="inputExcelCentros" accept=".xlsx,.xls" style="display:none">
          </div>
        </article>

        <!-- Calendario -->
        <article class="card">
          <div class="calendar-grid">
            <div class="calendar-header">
              <button class="btn" id="calPrevMes" style="padding:2px 8px;font-size:.78rem;">‚óÄ</button>
              <span id="calTituloMes" style="font-size:.95rem;font-weight:600;"></span>
              <button class="btn" id="calNextMes" style="padding:2px 8px;font-size:.78rem;">‚ñ∂</button>
            </div>
            <div class="calendar-weekdays">
              <span>L</span><span>M</span><span>X</span><span>J</span><span>V</span><span>S</span><span>D</span>
            </div>
            <div class="calendar-days" id="calendarDays"></div>
          </div>
        </article>

        <!-- Visitas -->
        <article class="card">
          <div class="page-header" style="margin-bottom:4px;">
            <h3 style="font-size:.9rem;">Visitas agendadas</h3>
          </div>
          <div class="visitas-list" id="visitasList">
            <!-- items demo -->
          </div>
        </article>
      </div>

      <!-- Tabla de centros -->
      <section class="centros-table-wrapper">
        <div class="page-header" style="margin-top:4px;">
          <div>
            <h3 style="font-size:.9rem;">Listado de centros</h3>
          </div>
          <span class="badge-small" id="totalCentrosLabel">Centros mostrados: 0 / 0</span>
        </div>
        <div class="centros-table-scroll">
          <table>
            <thead>
              <tr>
                <th>C√≥digo</th>
                <th>Propietario</th>
                <th>Centro</th>
                <th>Provincia</th>
                <th>Delegado</th>
                <th>Tipo</th>
                <th>Informes</th>
                <th>Centro AAR</th>
              </tr>
            </thead>
            <tbody id="tablaCentrosBody"></tbody>
          </table>
        </div>
      </section>
    </section>

    <!-- INFORME DE LA VISITA -->
    <section id="page-informe" class="page">
      <div class="page-header">
        <h2>Informe de la visita</h2>
      </div>

      <div class="informe-page">
        <div class="informe-main-print">
          <!-- 1) DATOS + CHECKLIST -->
          <div class="informe-top-row">
            <article class="informe-card">
              <h3 style="font-size:.9rem;">Datos del centro</h3>
              <div class="informe-datos-grid">
                <div class="informe-field">
                  <label>Centro</label>
                  <input id="infCentro" />
                </div>
                <div class="informe-field">
                  <label>Provincia</label>
                  <input id="infProvincia" />
                </div>
                <div class="informe-field">
                  <label>Delegado</label>
                  <input id="infDelegado" />
                </div>
                <div class="informe-field">
                  <label>Tipo</label>
                  <input id="infTipo" />
                </div>
                <div class="informe-field">
                  <label>Responsable audio</label>
                  <input id="infRespAudio" />
                </div>
                <div class="informe-field">
                  <label>Fecha visita</label>
                  <input id="infFecha" />
                </div>
                <div class="informe-field">
                  <label>Audi√≥logo</label>
                  <input id="infAudiologo" />
                </div>
                <div class="informe-field">
                  <label>Horas de servicio</label>
                  <input id="infHoras" />
                </div>
              </div>
            </article>

            <article class="informe-card">
              <div class="checklist-head">
                <div>
                  <h3 style="font-size:.9rem;">Checklist de visita</h3>
                  <small>Adjunta el checklist del centro (Corner o Exclusivo). Los KPIs se calcular√°n a partir de este archivo.</small>
                </div>
              </div>
              <div style="display:flex; gap:6px; align-items:center; margin-top:4px;">
                <input type="file" id="checklistFile" accept=".xlsx,.xls" />
                <button class="btn btn-cta" id="btnAdjuntarChecklist">Adjuntar checklist</button>
              </div>
              <p id="checklistFileName" class="checklist-file-info">
                Ning√∫n checklist adjunto (demo).
              </p>
            </article>
          </div>

          <!-- 2) KPIs + RADAR -->
          <div class="informe-middle-row">
            <article class="informe-card kpi-chart-box">
              <h3 style="font-size:.9rem;">KPIs del centro</h3>
              <canvas id="chartKPIsCentro"></canvas>
            </article>
            <article class="informe-card radar-chart-box">
              <h3 style="font-size:.9rem;">Radar del centro</h3>
              <canvas id="chartRadarCentro"></canvas>
            </article>
          </div>

          <!-- 3) FORMACIONES + IM√ÅGENES -->
          <div class="informe-third-row">
            <article class="informe-card formaciones-box">
              <h3 style="font-size:.9rem;">Formaciones y habilidades</h3>
              <div class="formaciones-box-inner" id="listaFormaciones">
                <!-- Grupo demo ‚Äì usa tus checkboxes reales -->
                <label><input type="checkbox"> WSA</label>
                <label><input type="checkbox"> Starkey</label>
                <label><input type="checkbox"> Habilidades comerciales / Neuroventas</label>
                <label><input type="checkbox"> HIT</label>
                <label><input type="checkbox"> Telecare</label>
                <label><input type="checkbox"> PIA</label>
                <label><input type="checkbox"> Telehear</label>
                <label><input type="checkbox"> Financiaci√≥n Infinity</label>
                <label><input type="checkbox"> Venta de seguro</label>
                <label><input type="checkbox"> Primeros auxilios (equipo)</label>
                <label><input type="checkbox"> Producto y comunicaci√≥n</label>
                <label><input type="checkbox"> Audiometr√≠a RT</label>
                <label><input type="checkbox"> Test de lectura audio</label>
                <label><input type="checkbox"> Screening audio</label>
                <label><input type="checkbox"> Manteleta audio</label>
                <label><input type="checkbox"> Escaparate visible audio</label>
                <label><input type="checkbox"> Salud auditiva en PDV</label>
                <label><input type="checkbox"> Elementos Renove</label>
                <label><input type="checkbox"> Elementos MGM</label>
                <label><input type="checkbox"> Stock</label>
                <label><input type="checkbox"> Tchin Tchin</label>
              </div>
            </article>

            <article class="informe-card">
              <h3 style="font-size:.9rem;">Im√°genes del centro</h3>
              <div class="imagenes-grid">
                <div class="imagen-drop">
                  <strong>Centro exterior</strong>
                  <input type="file" accept="image/*">
                  <span>Adjuntar imagen</span>
                </div>
                <div class="imagen-drop">
                  <strong>Centro interior</strong>
                  <input type="file" accept="image/*">
                  <span>Adjuntar imagen</span>
                </div>
                <div class="imagen-drop">
                  <strong>Gabinete</strong>
                  <input type="file" accept="image/*">
                  <span>Adjuntar imagen</span>
                </div>
              </div>
            </article>
          </div>

          <!-- 4) RESUMEN DE LA VISITA: 3 GR√ÅFICAS -->
          <article class="informe-card">
            <h3 style="font-size:.9rem;">Resumen de la visita</h3>
            <div class="informe-resumen-row">
              <div class="resumen-chart-box">
                <canvas id="chartProcesosAplicados"></canvas>
              </div>
              <div class="resumen-chart-box">
                <canvas id="chartAreasMejoraCentro"></canvas>
              </div>
              <div class="resumen-chart-box">
                <canvas id="chartConversionCentro"></canvas>
              </div>
            </div>
          </article>

          <!-- 5) TEXTO -->
          <article class="informe-card">
            <div class="informe-text-row">
              <div class="informe-text-area">
                <label for="txtObservaciones">Observaciones</label>
                <textarea id="txtObservaciones"></textarea>
              </div>
              <div class="informe-text-area">
                <label for="txtRecomendaciones">Recomendaciones</label>
                <textarea id="txtRecomendaciones"></textarea>
              </div>
              <div class="informe-text-area">
                <label for="txtCompromisos">Compromisos</label>
                <textarea id="txtCompromisos"></textarea>
              </div>
            </div>
            <div class="informe-footer">
              <button class="btn btn-cta" id="btnGuardarInforme">Guardar informe</button>
            </div>
          </article>
        </div>

        <!-- 2¬™ HOJA: CHECKLIST PARA IMPRESI√ìN -->
        <article class="informe-card" id="checklistImprimibleCard">
          <h3 style="font-size:.9rem;">Checklist anexado (para impresi√≥n)</h3>
          <div id="checklistImprimible">
            <p style="font-size:.75rem; color:var(--text-muted);">
              No hay checklist cargado. Cuando adjuntes un Excel, se mostrar√° aqu√≠ en forma de tabla.
            </p>
          </div>
        </article>
      </div>
    </section>
  </main>

  <script>
    // ====== UTILIDADES B√ÅSICAS ======
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);

    // NAV entre p√°ginas
    const pages = {
      dashboard: $('#page-dashboard'),
      centros: $('#page-centros'),
      informe: $('#page-informe')
    };

    $$('#navList .nav-item').forEach(item => {
      item.addEventListener('click', () => {
        $$('#navList .nav-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        const page = item.dataset.page;
        Object.keys(pages).forEach(k => pages[k].classList.remove('active'));
        pages[page].classList.add('active');
      });
    });

    // Tema claro / oscuro
    $('#themeToggle').addEventListener('click', () => {
      document.body.classList.toggle('light');
    });

    // Exportar HTML (archivo √∫nico)
    $('#btnExportHtml').addEventListener('click', () => {
      const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'control-center-audio.html';
      a.click();
      URL.revokeObjectURL(url);
    });

    // Imprimir secci√≥n activa
    $('#btnPrint').addEventListener('click', () => {
      window.print();
    });

    // ====== DASHBOARD ‚Äì CHARTS DEMO ======
    let dashRadar, dashProcesosAreas, dashAreasMes, dashPrimerosAux, dashTopAreas, dashAARHIT;

    function makeBarChart(ctx, labels, data, color, stacked=false, max=100) {
      return new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            data,
            backgroundColor: color
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              max: max,
              ticks: {
                callback: v => v + '%'
              }
            }
          },
          plugins: {
            legend: {display:false},
            tooltip: {
              callbacks: {
                label: ctx => ctx.parsed.y + '%'
              }
            }
          }
        }
      });
    }

    function makeLineChart(ctx, labels, data, color) {
      return new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            data,
            borderColor: color,
            backgroundColor: 'transparent',
            tension: 0.3,
            pointRadius: 3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              ticks: { callback: v => v + '%' }
            }
          },
          plugins: { legend: {display:false} }
        }
      });
    }

    function makeDonut(ctx, labels, data, colors) {
      return new Chart(ctx, {
        type: 'doughnut',
        data: { labels, datasets: [{ data, backgroundColor: colors }]},
        options: {
          responsive:true,
          maintainAspectRatio:false,
          plugins: { legend:{position:'bottom'} }
        }
      });
    }

    function makeRadar(ctx, labels, data) {
      return new Chart(ctx, {
        type:'radar',
        data:{
          labels,
          datasets:[{
            data,
            borderColor:'#38bdf8',
            backgroundColor:'rgba(56,189,248,0.15)',
            pointBackgroundColor:'#38bdf8'
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          plugins:{legend:{display:false}},
          scales:{
            r:{
              beginAtZero:true,
              max:100,
              ticks:{display:false}
            }
          }
        }
      });
    }

    function initDashboard() {
      const meses = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov'];
      dashRadar = makeRadar($('#dashRadar'), ['Procesos','Conv. prueba','Conv. venta','Formaci√≥n','Producto'], [80,75,70,65,60]);
      dashProcesosAreas = new Chart($('#dashProcesosAreas'), {
        type:'bar',
        data:{
          labels: meses,
          datasets:[
            {
              type:'line',
              label:'Procesos %',
              data:[70,72,75,78,80,82,83,84,85,86,87],
              borderColor:'#38bdf8',
              backgroundColor:'transparent',
              yAxisID:'y'
            },
            {
              type:'bar',
              label:'√Åreas de mejora',
              data:[6,6,5,5,4,4,3,3,3,2,2].map(x=>x*10),
              backgroundColor:'#f97316',
              yAxisID:'y'
            }
          ]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          scales:{
            y:{
              beginAtZero:true,
              max:100,
              ticks:{callback:v=>v+'%'}
            }
          },
          plugins:{legend:{display:false}}
        }
      });

      dashAreasMes = makeBarChart($('#dashAreasMes'), meses, [6,6,5,5,4,4,3,3,3,2,2].map(x=>x*10), '#ef4444');
      dashPrimerosAux = makeBarChart($('#dashPrimerosAux'), meses, [10,20,30,40,50,60,70,75,80,85,90], '#22c55e');
      dashTopAreas = makeBarChart($('#dashTopAreas'), ['Seguimiento','Escaparate','Formaci√≥n','Postventa','Citas'], [60,55,50,45,40], '#60a5fa', false, 100);
      dashAARHIT = makeDonut($('#dashAARHIT'), ['Centros con AAR','Sin AAR'], [65,35], ['#22c55e','#ef4444']);

      // KPIs superiores demo
      $('#kpiProcesos').textContent = '82%';
      $('#kpiConvPrueba').textContent = '78%';
      $('#kpiConvVenta').textContent = '72%';
      $('#kpiPrimerosAux').textContent = '68%';

      // Ranking demo
      const delegadosDemo = [
        {nombre:'Blanca Fdez. de la Pradilla', score:90},
        {nombre:'Sergio Per√°n', score:87},
        {nombre:'Daniel Chazo', score:84},
        {nombre:'Sonia Godino', score:83},
        {nombre:'Eneritz ARANGUREN', score:83},
        {nombre:'Marisa Carmona', score:80},
      ];
      const cont = $('#rankingDelegados');
      cont.innerHTML = '';
      delegadosDemo.forEach((d,idx)=>{
        const row = document.createElement('div');
        row.className = 'ranking-item';
        row.innerHTML = `
          <span style="width:18px;font-size:.72rem;">${idx+1}.</span>
          <span class="ranking-name">${d.nombre}</span>
          <div class="ranking-bar"><div class="ranking-bar-fill" style="width:${d.score}%;"></div></div>
          <span style="width:26px;font-size:.72rem;">${d.score}</span>
        `;
        cont.appendChild(row);
      });
      $('#btnMostrarTodosDeleg').addEventListener('click',()=>alert('En una versi√≥n real se mostrar√≠an todos los delegados.'));
    }

    // ====== CENTROS ‚Äì DEMO SIMPLE ======
    const delegadosColores = {
      "Daniel Chazo": "#a855f7",
      "ENERITZ ARANGUREN": "#22c55e",
      "Blanca Fdez. de la Pradilla": "#ec4899",
      "Marisa Carmona": "#eab308",
      "Sergio Per√°n": "#fb7185",
      "Sonia Godino": "#22d3ee"
    };

    const centros = [
      {codigo:"4ABB", propietario:"MAZA Oriol", centro:"PAMPLONA C. Exclusivo", provincia:"NAVARRA", delegado:"Sonia Godino", tipo:"Exclusivo", aar:"No"},
      {codigo:"4AFH", propietario:"MAZA Oriol", centro:"PAMPLONA Calle Sancho el Mayor", provincia:"NAVARRA", delegado:"Sonia Godino", tipo:"Exclusivo", aar:"No"},
      {codigo:"4AWQ", propietario:"MAZA Oriol", centro:"PAMPLONA Carlos III", provincia:"NAVARRA", delegado:"Sonia Godino", tipo:"Exclusivo", aar:"No"},
      {codigo:"4MRM", propietario:"AAO", centro:"REINA DE MERCEDES", provincia:"Madrid", delegado:"Sergio Per√°n", tipo:"Exclusivo", aar:"S√≠"},
      {codigo:"4PEC", propietario:"AAO", centro:"SANTANDER CC PE√ëACASTILLO", provincia:"Santander", delegado:"Sergio Per√°n", tipo:"Exclusivo", aar:"No"},
      {codigo:"4AXF", propietario:"URRUTIA Esteban", centro:"SANTIAGO DE COMPOSTELA RUA DA ROSA", provincia:"A Coru√±a", delegado:"Daniel Chazo", tipo:"Exclusivo", aar:"No"},
      {codigo:"4TOL", propietario:"AAO", centro:"TORRELAVEGA CARREFOUR CC", provincia:"Santander", delegado:"Sergio Per√°n", tipo:"Exclusivo", aar:"No"},
      {codigo:"4ZDE", propietario:"AAO", centro:"ZARAGOZA CALLE DELICIAS", provincia:"ZARAGOZA", delegado:"ENERITZ ARANGUREN", tipo:"Exclusivo", aar:"No"},
      {codigo:"4AKI", propietario:"PIEDRAFITA Rocio", centro:"CC LOS VALLES", provincia:"MADRID", delegado:"Blanca Fdez. de la Pradilla", tipo:"Exclusivo", aar:"No"},
      {codigo:"4MLG", propietario:"AAO", centro:"FUENLABRADA Calle Leganes", provincia:"MADRID", delegado:"Marisa Carmona", tipo:"Exclusivo", aar:"No"}
    ];

    function renderDelegadosList() {
      const cont = $('#delegadosList');
      cont.innerHTML = '';
      const map = new Map();
      centros.forEach(c => {
        map.set(c.delegado, (map.get(c.delegado)||0) + 1);
      });
      $('#badgeNumDelegados').textContent = `${map.size} delegados`;
      [...map.entries()].sort().forEach(([nombre,count])=>{
        const div = document.createElement('div');
        div.className = 'delegado-bar';
        const color = delegadosColores[nombre] || '#e5e7eb';
        div.innerHTML = `
          <span class="delegado-bar-color" style="background:${color}"></span>
          <div class="delegado-bar-main">
            <span>${nombre}</span>
            <span>${count} centros</span>
          </div>
        `;
        cont.appendChild(div);
      });
    }

    function renderTablaCentros() {
      const tb = $('#tablaCentrosBody');
      tb.innerHTML = '';
      centros.forEach(c=>{
        const tr = document.createElement('tr');
        const tagTipo = c.tipo === 'Exclusivo' ? 'exclusivo':'corner';
        const aarEstado = c.aar || 'No';
        const aarClass = aarEstado === 'S√≠' ? 'si' : aarEstado === 'En formaci√≥n' ? 'formacion':'';
        tr.innerHTML = `
          <td>${c.codigo}</td>
          <td>${c.propietario}</td>
          <td>${c.centro}</td>
          <td>${c.provincia}</td>
          <td>${c.delegado}</td>
          <td><span class="tag ${tagTipo}">${c.tipo}</span></td>
          <td><button class="btn-link">A√±adir informe</button></td>
          <td><span class="tag tag-aar ${aarClass}">${aarEstado}</span></td>
        `;
        tb.appendChild(tr);
      });
      $('#totalCentrosLabel').textContent = `Centros mostrados: ${centros.length} / ${centros.length}`;
    }

    // Calendario simple
    let currentCalDate = new Date();
    function renderCalendar() {
      const year = currentCalDate.getFullYear();
      const month = currentCalDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month+1, 0);
      const cont = $('#calendarDays');
      cont.innerHTML = '';
      $('#calTituloMes').textContent = firstDay.toLocaleString('es-ES',{month:'long',year:'numeric'});

      let start = (firstDay.getDay() + 6) % 7; // lunes=0
      for(let i=0;i<start;i++){
        const cell = document.createElement('div');
        cont.appendChild(cell);
      }
      const today = new Date();
      for(let d=1; d<=lastDay.getDate(); d++){
        const cell = document.createElement('div');
        cell.className = 'calendar-day';
        const isToday = d===today.getDate() && month===today.getMonth() && year===today.getFullYear();
        if(isToday) cell.classList.add('today');
        cell.innerHTML = `<span class="day-number">${d}</span>`;
        // demo: un d√≠a con visitas
        if(d===4) {
          const badge = document.createElement('span');
          badge.className='day-badge';
          cell.appendChild(badge);
        }
        cont.appendChild(cell);
      }
    }

    function renderVisitasDemo() {
      const list = $('#visitasList');
      list.innerHTML = '';
      const demo = [
        {fecha:'2025-12-04', centro:'ALBACETE CC LOS LLANOS', delegado:'Albacete', resp:'Ariannys Rojas', estado:'Pendiente'},
      ];
      demo.forEach(v=>{
        const item = document.createElement('div');
        item.className = 'visita-item';
        const estadoClass = v.estado === 'Pendiente' ? 'tag-pendiente' : v.estado === 'Realizada' ? 'tag-realizada' : 'tag-anulada';
        item.innerHTML = `
          <div class="visita-topline">
            <span>${v.fecha} ¬∑ ${v.centro}</span>
            <span class="tag-estado ${estadoClass}">${v.estado}</span>
          </div>
          <div style="font-size:.72rem;color:var(--text-muted);">Del.: ${v.delegado} ¬∑ Resp. audio: ${v.resp}</div>
        `;
        list.appendChild(item);
      });
    }

    $('#calPrevMes').addEventListener('click', ()=>{currentCalDate.setMonth(currentCalDate.getMonth()-1);renderCalendar();});
    $('#calNextMes').addEventListener('click', ()=>{currentCalDate.setMonth(currentCalDate.getMonth()+1);renderCalendar();});

    // ====== INFORME DE LA VISITA ‚Äì CHARTS Y CHECKLIST ======
    let chartKPIsCentro, chartRadarCentro, chartProc, chartAreasCentro, chartConvCentro;

    function initInformeChartsDemo() {
      chartKPIsCentro = makeBarChart($('#chartKPIsCentro'), ['Procesos','Conv. prueba','Conv. venta','HIT','Formaciones','AAR'], [90,82,78,70,60,55], '#60a5fa');
      chartRadarCentro = makeRadar($('#chartRadarCentro'), ['Procesos','Conv. prueba','Conv. venta','Formaci√≥n','Producto'], [90,82,78,65,70]);
      chartProc = makeDonut($('#chartProcesosAplicados'), ['Aplicados','Pendientes'], [75,25], ['#22c55e','#ef4444']);
      chartAreasCentro = makeBarChart($('#chartAreasMejoraCentro'), ['Procesos','Formaci√≥n','HIT','Producto','Comunicaci√≥n'], [30,20,10,20,10], '#f97316', false, 100);
      chartConvCentro = makeBarChart($('#chartConversionCentro'), ['Conv. prueba','Conv. venta'], [80,72], '#22c55e', false, 100);
    }

    $('#btnAdjuntarChecklist').addEventListener('click', () => {
      const fileInput = $('#checklistFile');
      const file = fileInput.files[0];
      if (!file) {
        alert('Selecciona primero un archivo Excel');
        return;
      }
      $('#checklistFileName').textContent = file.name;

      const reader = new FileReader();
      reader.onload = evt => {
        const data = new Uint8Array(evt.target.result);
        const wb = XLSX.read(data, { type: 'array' });
        const sheet = wb.Sheets[wb.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });

        // Construir tabla checklist para impresi√≥n
        const table = document.createElement('table');
        json.forEach((row, idx) => {
          const tr = document.createElement('tr');
          row.forEach(cell => {
            const el = document.createElement(idx===0?'th':'td');
            el.textContent = cell ?? '';
            tr.appendChild(el);
          });
          table.appendChild(tr);
        });
        const cont = $('#checklistImprimible');
        cont.innerHTML = '';
        cont.appendChild(table);

        // >>> AQU√ç ENGANCHAR√ÅS LA L√ìGICA REAL CON CELDAS F90 / F104 / etc. <<<
        // De momento se actualizan los gr√°ficos con los mismos valores demo
        chartKPIsCentro.data.datasets[0].data = [90,82,78,70,60,55];
        chartKPIsCentro.update();
        chartRadarCentro.data.datasets[0].data = [90,82,78,65,70];
        chartRadarCentro.update();
        chartProc.data.datasets[0].data = [75,25];
        chartProc.update();
        chartAreasCentro.update();
        chartConvCentro.update();
      };
      reader.readAsArrayBuffer(file);
    });

    $('#btnGuardarInforme').addEventListener('click', () => {
      alert('En una versi√≥n completa, aqu√≠ se guardar√≠a el informe y se actualizar√≠an los KPIs del dashboard.');
    });

    // ====== INIT GENERAL ======
    document.addEventListener('DOMContentLoaded', () => {
      initDashboard();
      renderDelegadosList();
      renderTablaCentros();
      renderCalendar();
      renderVisitasDemo();
      initInformeChartsDemo();
    });
  </script>
</body>
</html>
