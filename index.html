<div className="bg-white p-6 rounded-2xl shadow">
  <div className="flex flex-wrap items-center justify-between gap-3 mb-2">
    <div>
      <h2 className="font-bold text-lg">
        Mapa horizontal de checklist de visita
      </h2>
      <p className="text-gray-500 text-sm">
        Etapas del proceso de audio según el checklist oficial.
      </p>
    </div>
    <div className="flex items-center gap-2 text-xs">
      <span>Ver datos de:</span>
      <select
        className="border rounded px-2 py-1 text-xs"
        value={checklistView}
        onChange={(e) =>
          setChecklistView(e.target.value as "global" | "store")
        }
      >
        <option value="global">Global</option>
        <option value="store" disabled={!selectedStore}>
          Centro seleccionado
        </option>
      </select>
    </div>
  </div>
  <div className="flex gap-4 overflow-x-auto pb-2">
    {CHECKLIST.map((stage, stageIdx) => (
      <div
        key={stage.etapa}
        className="min-w-[260px] max-w-xs bg-gray-50 border rounded-2xl px-4 py-3 flex-shrink-0"
      >
        <div className="flex items-center justify-between mb-2">
          <span className="text-[11px] font-bold uppercase tracking-wide text-red-700">
            {stage.etapa}
          </span>
          <span className="text-[10px] text-gray-500">
            {stage.items.length} pts
          </span>
        </div>
        <ul className="space-y-1">
          {stage.items.map((item, itemIdx) => {
            const globalIdx = STAGE_OFFSETS[stageIdx] + itemIdx;
            const pct =
              checklistView === "global"
                ? globalPointAverages[globalIdx]
                : storePointAverages[globalIdx];

            const colorClass =
              pct == null
                ? "bg-gray-200 text-gray-700"
                : pct >= 85
                ? "bg-green-100 text-green-800"
                : "bg-red-100 text-red-700";

            return (
              <li
                key={itemIdx}
                className="text-[11px] text-gray-700 flex gap-1 items-center"
              >
                <span className="mt-1 h-1.5 w-1.5 rounded-full bg-red-500 flex-shrink-0" />
                <span className="leading-tight flex-1">{item}</span>
                <span
                  className={`ml-1 px-1.5 py-0.5 rounded-full whitespace-nowrap ${colorClass}`}
                >
                  {pct == null ? "–" : `${pct.toFixed(0)}%`}
                </span>
              </li>
            );
          })}
        </ul>
      </div>
    ))}
  </div>
</div>
